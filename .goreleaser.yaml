version: 2

project_name: toshiki-captcha-bot

before:
  hooks:
    - go mod tidy

git:
  ignore_tags:
    - "{{ if not .IsNightly }}*-rc*{{ end }}"

builds:
  - id: toshiki-captcha-bot
    binary: toshiki-captcha-bot
    env:
      - CGO_ENABLED=0
    tags:
      - netgo
      - osusergo
    ldflags:
      - -s -w -X main.Version={{ .Version }} -X main.Commit={{ .Commit }} -X main.BuildTime={{ .Date }}
    goos:
      - linux
      - windows
      - darwin
    goarch:
      - amd64
      - arm64

  - id: toshiki-captcha-bot-linux-armv7
    binary: toshiki-captcha-bot
    env:
      - CGO_ENABLED=0
    tags:
      - netgo
      - osusergo
    ldflags:
      - -s -w -X main.Version={{ .Version }} -X main.Commit={{ .Commit }} -X main.BuildTime={{ .Date }}
    goos:
      - linux
    goarch:
      - arm
    goarm:
      - "7"

archives:
  - id: toshiki-captcha-bot
    name_template: >-
      toshiki-captcha-bot-
      {{- if eq .Os "darwin" }}darwin{{- else if eq .Os "linux" }}linux{{- else if eq .Os "windows" }}windows{{- else if eq .Os "freebsd" }}freebsd{{- else if eq .Os "openbsd" }}openbsd{{- else if eq .Os "netbsd" }}netbsd{{- else if eq .Os "dragonfly" }}dragonfly{{- else }}{{ .Os }}{{ end }}-
      {{- if eq .Arch "amd64" }}x86-64{{- else if eq .Arch "386" }}i386{{- else if eq .Arch "arm64" }}aarch64{{- else if eq .Arch "arm" }}armv{{ .Arm }}{{- else if eq .Arch "mips" }}mips{{- if .Mips }}-{{ .Mips }}{{ end }}{{- else if eq .Arch "mipsle" }}mipsle{{- if .Mips }}-{{ .Mips }}{{ end }}{{- else if eq .Arch "mips64" }}mips64{{- if .Mips }}-{{ .Mips }}{{ end }}{{- else if eq .Arch "mips64le" }}mips64le{{- if .Mips }}-{{ .Mips }}{{ end }}{{- else if eq .Arch "ppc64" }}ppc64{{- else if eq .Arch "ppc64le" }}ppc64le{{- else if eq .Arch "riscv64" }}riscv64{{- else if eq .Arch "s390x" }}s390x{{- else }}{{ .Arch }}{{ end }}-
      {{- .Tag }}
    format_overrides:
      - goos: windows
        formats: [zip]
    files:
      - README.md
      - LICENSE
      - config.example.yaml

checksum:
  name_template: checksums.txt

snapshot:
  version_template: "{{ incpatch .Version }}-next"

changelog:
  use: git
  format: "[`{{ .SHA }}`](https://github.com/andatoshiki/toshiki-captcha-bot/commit/{{ .SHA }}): {{ .Message }}"
  abbrev: 7

release:
  prerelease: auto
  header: |
    # {{ .Tag }} Changes

    Release maintained by Anda Toshiki.
